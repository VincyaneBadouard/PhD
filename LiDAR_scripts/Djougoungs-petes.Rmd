---
title: "Djougoungs-petes"
author: "Vincyane Badouard"
date: "`r Sys.Date()`"
output: pdf_document
---
Est-ce qu’on les voit au LiDAR ?
voir sur Fugroviewer ou qgis (d'abord) : triangulation des points sols (tin)


# Packages
```{r, include = F}
library(tidyverse)
library(lidR)
library(data.table)
library(rgl) # visulaisation 3D
library(terra)
library(sf)
library(ggplot2)
```

# The point cloud path 
Il faut l'ALS de tout Paracou ou d'une parcelle où les Djougoungs ont été inventoriés (pas la 16)
soit clipper les parcelles d'intérêt, soit récupérer l'ensemble des points sol. 
```{r}
# catalog
ctg <- readLAScatalog(folder= "Y:/lidar/ALS/Paracou/2022/TiledClassified")
```

```{r}
ALS_P16_2022_path <- "Z:/users/VincyaneBadouard/ALS2022/P16_2022_dnz_4ha.laz"
```

```{r}
trajfilenames <- list.files("Y:/lidar/ALS/Paracou/2022/TiledClassified", pattern="*.laz", full.names=TRUE) # catch the name of all the files of the folder

df_list <- lapply(trajfilenames, readLAS) # read all the folder files
ALS_Paracou2022 <- bind_rows(df_list)

```

# Import the points cloud
```{r}
ST <- readLAS(ALS_P16_2022_path)
```

# Keep only ground data
Que sur données sol de la dernière acquisition sur lidR (triangulation surface))
```{r}
# Modèle numérique de terrain
mnt <- rast("Z:/users/VincyaneBadouard/ALS2022/mnt_roi36ha_1m.asc")
plot(mnt)

# Normaliser la hauteur du sol
ST_norm <- lidR::normalize_height(ST, mnt) # applati le relief
plot(ST_norm)# sol plat

# Classifier les points
ST_norm@data[(Z>(-0.2) & Z< 0.5), Classification := 2] 

table(ST_norm@data$Classification) # 7 = bruit, 2 = sol, vegetation = 3,4,5
# plot(ST_norm, color = "Classification") # trop long

# Dénormaliser la hauteur du sol
ST <- lidR::unnormalize_height(ST_norm) 
```

```{r}
# Prendre que ce qui concerne le sol
GP <- copy(ST)
GP@data=GP@data[(Classification==2 | Classification==7),] # Ground Points
GS=ST@data[gpstime %in% GP$gpstime,] # temps gps des tirs dont l'echo est au sol
# question : pq prendre tous les tirs pris en meme temps que les tirs ayant touché le sol, et pas juste prendre les données sol (=2) ?
# Question : pq prendre aussi les Classification = 7 (bruit)

```

# Can we see the Djougoungs?
## Import Djougoungs map
```{r}
Thalweg_Djougoung <- st_read("D:/Mes Donnees/PhD/SIG_data/Djougoung-petes/Thalwegs.shp")
Paracou <- st_read("D:/Mes Donnees/PhD/SIG_data/Plots Paracou/OverallPlots.shp")
```
```{r}
Paracou_Plot <- Paracou %>% 
  filter(Project == "ParacouCIRAD") %>% 
  filter(Subplot == 2) %>% 
  select(Plot, geometry) %>% 
  unique()

ggplot() + 
  geom_sf(data = Paracou) + 
  geom_sf_text(data = Paracou_Plot, aes(label = Plot), colour = "black") +
  geom_sf(data = Thalweg_Djougoung, aes(fill = Type)) + 
  ggtitle("Paracou 2019 - Thalwegs and Djougoung petes") + 
  coord_sf()
```
On trouve des Djougoungs pétés dans 8 parcelles (P2, P5, P6, P7, P9, P11, P13 et P15).
Leur superficie est la plus étendue dans les parcelles **P13** et **P11**.

```{r}
plot(GP)
```

