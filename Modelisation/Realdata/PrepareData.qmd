# Prepare data

# Packages
```{r Setup, include = F}
library(readr)
library(tidyverse)
```

```{r, include = F, message=F}
Inv <- read_csv("D:/Mes Donnees/PhD/Inventories/Data/Understory/Paracou/P16_Paracou_InvandEnv.csv")
```

```{r}
Inv <- Inv %>% 
  mutate(logTransmittance =  log(Transmittance))
```

```{r, eval=F}

## Only sp enough abundant in < and > 10 cm DBH
data <- Inv %>%
  na.omit() %>% 
  mutate(ALT = ifelse(DBHcor <10, T, F))

Guyafor <- data %>% # 808
  filter(!ALT) %>% 
  group_by(ScientificName) %>%
  mutate(N = n()) %>%
  ungroup() %>%
  # Take only sp >= 30 ind
  filter(N >= 30)


ALT <- data %>% #5887
  filter(ALT) %>%  
  filter(ScientificName %in% Guyafor$ScientificName | Strategy=="Understory species") %>%
  group_by(ScientificName) %>%
  mutate(N = n()) %>%
  ungroup() %>%
  # Take only sp >= 30 ind
  filter(N >= 30)

s <- Guyafor$ScientificName %in% ALT$ScientificName

Guyafor <- Guyafor %>% # 736
  dplyr::filter(s) 

data <- ALT %>% #6623
  bind_rows(Guyafor) %>% 
  arrange(Strategy, N) %>% 
  mutate(cl = ifelse(Strategy =="Understory species" & !is.na(Strategy), "#009E73",
                     "#E7B800")) %>% # color per sp strategy
  select(-N) %>% 
  group_by(ScientificName) %>% 
  mutate(N = n()) %>% 
  ungroup() 

nrow(data)==(nrow(ALT)+nrow(Guyafor))
length(unique(data$ScientificName)) # 34 sp (4ha)

rm(Inv, ALT, Guyafor, s)
```

# Create presence-absence data format for each species
```{r}
sp <- (read.csv("D:/Mes Donnees/PhD/Inventories/Data/Understory/Paracou/InterestSpecies.csv")[,2]) # 75
# length(unique(sp))

# Create a list of the inventory replicated, 1 per ScientificName
datalist <- replicate(length(sp), Inv, simplify = F) 
names(datalist) <- sp # 1 per ScientificName

# Presence=1 if it's the interest species, 0 if not
datalist <- lapply(names(datalist), function(name) {
  datalist[[name]]$Presence <- ifelse(
    !is.na(datalist[[name]]$ScientificName) & datalist[[name]]$ScientificName == name, 1, 0)
  
  datalist[[name]]  # Return modified data frame
})
names(datalist) <- sp # 75

# view(datalist[["Anaxagorea_dolichocarpa"]])
```

```{r}
save(datalist, file= "D:/Mes Donnees/PhD/R_codes/PhD/Modelisation/Realdata/Realsp_25ha.Rdata")
```

