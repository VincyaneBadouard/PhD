---
title: "O bounds exploration"
date: "`r Sys.Date()`"
format: html
self-contained: true
theme: cosmo
editor: source
code-fold: true
---

**Objectives:**
Sigmoid optimum can be estimated outside of the environmental range.  
To have a reasonable quadratic optimum for the sigmoid case, we want to bound "O", for that we need to explore what neet to be a and gamma values to visualize the curve between the environment bounds.  

Pour moi la question est : peut-on permettre des bornes de O plus large, quels a et gamma ça nécessite pour les voir et est-ce que ces valeurs de paramètres sont de même ordre que pour des O sur le range environnementale (pour éviter les cas de divergence) ? 

Pour Géraldine la question est : si on restreint O à la gamme observable, est-ce qu'on peut quand même avoir toutes les formes, et en particulier toutes les formes de signmoides.

a = beta2  
O = extremum : -beta1/(2*beta2)  
gamma = alpha-(beta1^2/4*beta2)  

- without model fit 
- on x [0,1] logged
- a <0 to force concave form   
- O at the environment bounds and between   
- (iota (interaction parameter) after)  
- plot lines on environment in abscissa  

https://www.alloprof.qc.ca/fr/eleves/bv/mathematiques/le-role-des-parametres-dans-une-fonction-polynom-m1127  

```{r setup, packages, include = F}
library(tidyverse)
```

# Minimum Optimum value
```{r}
# Generates all combination of parameters

tidyr::crossing(
  a = c(-0.001, -0.02, -0.05, -0.25, -1, -5), 
  O = c(-8, -6, -3, 0),
  gamma = c(-3, -1, -0.5, 1, 2, 3, 4, 5, 7, 10, 15, 30, 60, 100, 200, 300, 500, 1000),
  Environment = (seq(-6,0, length.out =50)) 
) %>% 
  mutate(P = 1 / (1 + exp(-(a * (Environment - O)^2 + gamma)))) %>% 
  # unite(a, O, gamma, col = "Combinaison", sep = " ", remove = F) %>% 
  # mutate(Combinaison = as.factor(Combinaison)) %>% 
  
  ggplot(aes(x=Environment, y=P, col = as.factor(O), group = paste(O, a, gamma))) +
  geom_line(linewidth=1) +
  facet_grid(a ~ gamma, labeller = label_both) +
  theme_bw()

ggsave("Explo_O_bounds.png", path = "D:/Mes Donnees/PhD/Figures/Modelisation/",
       width = 45, height = 25, units = "cm", dpi=800, bg="white")
```
-> gamma = hauteur de la parabole (quand gamma croit la hauteur de la parabole croit)  
-> a = ouverture de la parabole (quand a croit la parabole s'élargit)  
-> O : valeur en x sur laquelle est centrée la parabole  

On peut voir que la courbe rouge (O=-8) n'apparait qu'après la disparition de la courbe bleue (O intermédiaire) et pour des gamma élévés, pour a = -5 (et nous souhaitons favoriser un a <0 pour forcer la forme concave), alors que les courbes dont l'optimum est la borne minimale ou maximale de x, sont toujours visibles avec la courbe bleu.  
-> donc il vaut mieux prendre pour O les **bornes les plus proches possible du range environnemental**  

# First O = -6 only
```{r}
# Generates all combination of parameters

tidyr::crossing(
  a = c(-0.25, -1,-10), 
  O = -6, #c(-6, -3, -1),
  gamma = c(-1, -0.5, 1, 2, 3, 4, 7,  15),
  Environment = (seq(-6,0, length.out =50)) 
) %>% 
  mutate(P = 1 / (1 + exp(-(a * (Environment - O)^2 + gamma)))) %>% 
  # unite(a, O, gamma, col = "Combinaison", sep = " ", remove = F) %>% 
  # mutate(Combinaison = as.factor(Combinaison)) %>% 
  
  ggplot(aes(x=Environment, y=P, col = as.factor(O), group = paste(O, a, gamma))) +
  geom_line(linewidth=1) +
  facet_grid(a ~ gamma, labeller = label_both) +
  theme_bw() +
  labs(col="Extremum")

ggsave("Explo_parameters_canonic_quadratic_1O.png", path = "D:/Mes Donnees/PhD/Figures/Modelisation", width = 25, height = 15, units = "cm", dpi=800, bg="white")
```

Pour tout a <0 et O = -6 (=borne inférieure de la variable loguée), la courbe sur l'intervale x observé, est **plate si gamma < (-3)**  

Plus **a est proche de 0** plus la courbe est plate et seuls de **faibles gamma** permettent de voir la courbe (car la parabole générée est trop grande pour la voir sur l'intervale x observé)  

Pour tout a <0, si **gamma est trop élévé** la courbe s'aplatit à y=1 sur l'intervale x observé, car quand la parabole ne peut plus grandir en hauteur elle s'élargit et s'écrase au y max.  

**Plus a est petit, plus gamma peut etre grand**  

# Optimum at the environment bounds and between
```{r}
# Generates all combination of parameters

tidyr::crossing(
  a = c(-0.001, -0.02, -0.05, -0.1, -0.25, -1, -5, -10, -20, -60, -100, -300, -100000, -1000000000000000000000), 
  O = c(-6, -3, 0),
  gamma = c(-3, -1, -0.5, 1, 2, 3, 4, 5, 7, 10, 15, 30, 60, 100, 2000, 3000),
  Environment = (seq(-6,0, length.out =50)) 
) %>% 
  mutate(P = 1 / (1 + exp(-(a * (Environment - O)^2 + gamma)))) %>% 
  # unite(a, O, gamma, col = "Combinaison", sep = " ", remove = F) %>% 
  # mutate(Combinaison = as.factor(Combinaison)) %>% 
  
  ggplot(aes(x=Environment, y=P, col = as.factor(O), group = paste(O, a, gamma))) +
  geom_line(linewidth=1) +
  facet_grid(a ~ gamma, labeller = label_both) +
  theme_bw()

# ggsave("Explo_parameters_canonic_quadratic.png", path = "D:/Mes Donnees/PhD/Figures/Modelisation/", 
#        width = 45, height = 25, units = "cm", dpi=800, bg="white")
```
-> la parabole (verte) centrée sur l'intervale x observé est la 1ère à s'applatir lorsque gamma augmente, et la derniere à s'applatir lorsque gamma diminue  

-> a peut etre infiniment petit, les paraboles d'optimum egale au bornes mimimum ou maximum de l'intervale x observé seront toujours visibles tant que gamma est > -3, par contre les paraboles intermédiaires ne pourront etre visibles que si gamma est extremement grand  

-> Pour rester sur des ordres de grandeurs non-exorbitant des paramètres a et gamma, et pour voir les paraboles d'optimum (O) au bornes du x observé et intermediaires, il faut un **gamma entre -2 et 200**, et un **a entre -0.05 et -300**, et plus a sera proche de 0, plus il faudra un gamma faible pour voir toutes les paraboles.



Bilan:
-> gamma = hauteur de la parabole (quand gamma croit la hauteur de la parabole croit)  
-> a = ouverture de la parabole (quand a croit la parabole s'élargit)  
-> O : valeur en x sur laquelle est centrée la parabole  

- Nous devons borner O sur l'intervale environnmental observé pour s'assurer de voir les courbes sur cet interval (Fig 1.).  
- gamma dot etre > -3 pour pouvoir observer les courbes.  
- Pour rester sur des ordres de grandeurs non-exorbitant des paramètres a et gamma, et pour voir les paraboles d'optimum (O) au bornes du x observé et intermediaires, il faut un **gamma entre -2 et 200**, et un **a entre -0.05 et -300**.  
- Plus a sera proche de 0, plus il faudra un gamma faible pour voir toutes les paraboles.  

# On the real values of a and gamma
chap 2 :
a [- 0.002 ; -0.3]
gamma [-10 ; 2]

chap 3 :
a [- 0.01 ; -4]
gamma [-23 ; 8]
```{r}
# Generates all combination of parameters

tidyr::crossing(
  a = c(-0.002, -0.01, -0.02, -0.05, -0.1, -1, -4), 
  O = c(-6, -3, 0),
  gamma = c(-23, -10, -5, -3, -2, -1, -0.5, 2, 4, 6, 8),
  Environment = (seq(-6,0, length.out =50)) 
) %>% 
  mutate(P = 1 / (1 + exp(-(a * (Environment - O)^2 + gamma)))) %>% 
  # unite(a, O, gamma, col = "Combinaison", sep = " ", remove = F) %>% 
  # mutate(Combinaison = as.factor(Combinaison)) %>% 
  
  ggplot(aes(x=Environment, y=P, col = as.factor(O), group = paste(O, a, gamma))) +
  geom_line(linewidth=1) +
  facet_grid(a ~ gamma, labeller = label_both) +
  scale_y_continuous(trans="sqrt") +
  theme_bw()

# ggsave("Explo_parameters_canonic_quadratic.png", path = "D:/Mes Donnees/PhD/Figures/Modelisation/", 
#        width = 45, height = 25, units = "cm", dpi=800, bg="white")
```
Flat niche:
when gamma < -3
when a < -0.01

