---
title: "Theorical_coordinates_P16"
author: "Vincyane"
date: "`r Sys.Date()`"
output: html_document
---
P16 : 25 ha
Coordonnées SO de la P16: (0;0)

```{r}
library(tidyverse)
library(sf)
library(terra)
```

# Subplots grid for 25 ha
```{r}
grid <- data.frame(expand.grid(
  x = seq(0,500, by= 100),
  y = seq(0,500, by= 100)
)
)
ggplot() +
  geom_point(data=grid, aes(x = x, y = y)) + # il faut mettre l'argument data sinon ça ne marche pas
  coord_fixed(ratio=1) # same axis size
```
# ALT stakes grid
```{r}
ALT <- data.frame(expand.grid(
  x = seq(0,500, by= 10),
  y = seq(0,500, by= 10)
)
)
ggplot() +
  geom_point(data=ALT, aes(x = x, y = y)) + # il faut mettre l'argument data sinon ça ne marche pas
  coord_fixed(ratio=1) # same axis size
```

# LAI200 sensors theorical coordinates
- transect HOBO : 20 points espacés de *10m* : start =(390;110)  ; end = (390;300)
- transect layon : 26 points espacés de *2m* : start = (350;200) ; end = (400; 200)
```{r}
LAI2200_HOBO <- data.frame(
  Sensor = "LAI2200",
  Transect = "HOBO",
  x = 390,
  y = seq(110,300, by= 10)
)
nrow(LAI2200_HOBO)==20

LAI2200_LAY <- data.frame(
  Sensor = "LAI2200",
  Transect = "LAY",
  x = seq(350,400, by= 2),
  y = 200
)
nrow(LAI2200_LAY)==26

LAI2200 <- rbind(LAI2200_HOBO, LAI2200_LAY)

ggplot() +
  geom_point(data=grid, aes(x = x, y = y)) + # il faut mettre l'argument data sinon ça ne marche pas
  geom_point(data=LAI2200_HOBO, aes(x = x, y = y), color = "red", size = 1)+
  geom_point(data=LAI2200_LAY, aes(x = x, y = y), color = "green", size = 0.3)+
  coord_fixed(ratio=1) # same axis size

```
# HOBO sensors theorical coordinates
- transect Jérome :
- transect BF :
- transect gap :
```{r}
# HOBO_jerome <-
# HOBO_BF <-
# HOBO_gap <-
```


# To UTM
P16 (x;y) :
NO	(285056;581678)
NE (285536;581821)
SE (285680; 581343)
SO (285201; 581199)

# Subplots grid for 25 ha in UTM 
```{r}
tab <- read_delim("D:/Mes Donnees/PhD/R_codes/PhD/local2UTM/CoordCoinsP1_16.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE)

P=16
limx = 500 # à changer pour la parcelle concernée
limy = 500 # à changer pour la parcelle concernée

gridUTM <- grid %>% 
  mutate(Xutm = (1-x/limx)*(1-y/limy)*tab[P,]$`so x`+(x/limx)*(1-y/limy)*tab[P,]$`se x`+(y/limy)*(1-x/limx)*tab[P,]$`no x`+((x*y)/(limx*limy))*tab[P,]$`ne x`) %>% 
  mutate(Yutm = (1-x/limx)*(1-y/limy)*tab[P,]$`so y`+(x/limx)*(1-y/limy)*tab[P,]$`se y`+(y/limy)*(1-x/limx)*tab[P,]$`no y`+((x*y)/(limx*limy))*tab[P,]$`ne y`)

P16shp <- st_as_sf(vect("D:/Mes Donnees/PhD/R_codes/PhD/test/Plot16.shp"))
gridUTMsf <- st_as_sf(gridUTM, coords = c('Xutm','Yutm'))
gridUTMsf <- st_set_crs(gridUTMsf, crs(P16shp))

ggplot() +
  geom_sf(data = sf::st_cast(P16shp, "LINESTRING")) +
  geom_sf(data = gridUTMsf)
```
# LAI2200 positions in UTM 
```{r}

LAI2200UTM <- LAI2200 %>% 
  mutate(Xutm = (1-x/limx)*(1-y/limy)*tab[P,]$`so x`+(x/limx)*(1-y/limy)*tab[P,]$`se x`+(y/limy)*(1-x/limx)*tab[P,]$`no x`+((x*y)/(limx*limy))*tab[P,]$`ne x`) %>% 
  mutate(Yutm = (1-x/limx)*(1-y/limy)*tab[P,]$`so y`+(x/limx)*(1-y/limy)*tab[P,]$`se y`+(y/limy)*(1-x/limx)*tab[P,]$`no y`+((x*y)/(limx*limy))*tab[P,]$`ne y`)

P16shp <- st_as_sf(vect("D:/Mes Donnees/PhD/R_codes/PhD/test/Plot16.shp"))
LAI2200UTMsf <- st_as_sf(LAI2200UTM, coords = c('Xutm','Yutm'))
LAI2200UTMsf <- st_set_crs(LAI2200UTMsf, crs(P16shp))

ggplot() +
  geom_sf(data = sf::st_cast(P16shp, "LINESTRING")) +
  geom_sf(data = gridUTMsf) +
  geom_sf(data = LAI2200UTMsf, col = "red", size = 0.3) +
  ggtitle("Paracou P16 - LAI2200 sensors positions")

# write.csv(LAI2200UTM, "//amap-data.cirad.fr/work/users/VincyaneBadouard/Lidar/ALS2023/LAI2200_theoretical_UTM.csv")
```

# Extract Z coord MNT to Points
```{r}
raster <- terra::rast("//amap-data.cirad.fr/work/users/VincyaneBadouard/Lidar/ALS2023/HighAltitudeFlight/PARACOU2023_DTM_1m.tif") # MNT

plot(raster) ; plot(LAI2200UTMsf, add = T)

LAI2200UTMxyz <- extract(raster, LAI2200UTMsf, xy = T) %>% # extract z
  rename(z= MNT_0.5m_IRD_500m_Paracou_284000_579500) %>% 
  left_join(LAI2200UTM, by= c("x" = "Xutm", "y" = "Yutm"))  # arrétée là, c'est pas les memes coordonnées
  # select(c(a, y, x, 1ercolnonmodified : dercol))

LAI2200UTMxyz


write.csv(LAI2200UTMxyz, ".csv")
```

